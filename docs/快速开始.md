# ğŸš€ å¿«é€Ÿå¼€å§‹ (ä½¿ç”¨ Docker Compose)

æ¨èä½¿ç”¨ Docker å’Œ Docker Compose è¿›è¡Œä¸€é”®éƒ¨ç½²ã€‚

## æ­¥éª¤ 1: å‡†å¤‡ `docker-compose.yaml`

1. åœ¨ä¸€ä¸ªåˆé€‚çš„ç›®å½•ï¼ˆä¾‹å¦‚ `~/danmuku`ï¼‰ä¸‹ï¼Œåˆ›å»º `docker-compose.yaml` æ–‡ä»¶å’Œæ‰€éœ€çš„æ–‡ä»¶å¤¹ `configï¼Œdb-data`ã€‚

```bash
mkdir -p ~/danmuku
cd ~/danmuku
mkdir -p db-data config
touch docker-compose.yaml
```

2. æ ¹æ®æ‚¨é€‰æ‹©çš„æ•°æ®åº“ï¼Œå°†ä»¥ä¸‹å†…å®¹ä¹‹ä¸€å¤åˆ¶åˆ° `docker-compose.yaml` æ–‡ä»¶ä¸­ã€‚

### æ–¹æ¡ˆ A: ä½¿ç”¨ MySQL (æ¨è)

```yaml
version: "3.8"
services:
  mysql:
    image: mysql:8.1.0-oracle
    container_name: danmu-mysql
    restart: unless-stopped
    environment:
      # !!! é‡è¦ï¼šè¯·åŠ¡å¿…æ›¿æ¢ä¸ºæ‚¨çš„å¼ºå¯†ç  !!!
      MYSQL_ROOT_PASSWORD: "your_strong_root_password"                  #æ•°æ®åº“rootå¯†ç 
      MYSQL_DATABASE: "danmuapi"                                        #æ•°æ®åº“åç§°
      MYSQL_USER: "danmuapi"                                            #æ•°æ®åº“ç”¨æˆ·å
      MYSQL_PASSWORD: "your_strong_user_password"                       #æ•°æ®åº“å¯†ç 
      TZ: "Asia/Shanghai"
    volumes:
      - ./db-data:/var/lib/mysql
    command:
      - '--character-set-server=utf8mb4'
      - '--collation-server=utf8mb4_unicode_ci'
      - '--binlog_expire_logs_seconds=259200' # è‡ªåŠ¨æ¸…ç†è¶…è¿‡3å¤©çš„binlogæ—¥å¿—
      - '--default-authentication-plugin=mysql_native_password' # ä½¿ç”¨ä¼ ç»Ÿå¯†ç è®¤è¯æ–¹å¼
    healthcheck:
      # ä½¿ç”¨mysqladmin pingå‘½ä»¤è¿›è¡Œå¥åº·æ£€æŸ¥ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡å¼•ç”¨å¯†ç 
      test: ["CMD-SHELL", "mysqladmin ping -u$${MYSQL_USER} -p$${MYSQL_PASSWORD}"]
      interval: 5s
      timeout: 3s
      retries: 5
      start_period: 30s

    networks:
      - misaka-net

  danmu-app:
    image: l429609201/misaka_danmu_server:latest
    container_name: misaka-danmu-server
    restart: unless-stopped
    depends_on:
      mysql:
        condition: service_healthy
    environment:
      # è®¾ç½®è¿è¡Œå®¹å™¨çš„ç”¨æˆ·å’Œç»„IDï¼Œä»¥åŒ¹é…æ‚¨å®¿ä¸»æœºçš„ç”¨æˆ·ï¼Œé¿å…æŒ‚è½½å·çš„æƒé™é—®é¢˜ã€‚
      - PUID=1000
      - PGID=1000
      - UMASK=0022
      - TZ=Asia/Shanghai
      # --- æ•°æ®åº“è¿æ¥é…ç½® ---
      - DANMUAPI_DATABASE__TYPE=mysql                         # æ•°æ®åº“ç±»å‹
      - DANMUAPI_DATABASE__HOST=mysql                         # ä½¿ç”¨æœåŠ¡å
      - DANMUAPI_DATABASE__PORT=3306                          # ç«¯å£å·
      - DANMUAPI_DATABASE__NAME=danmuapi                      # æ•°æ®åº“åç§°
      # !!! é‡è¦ï¼šè¯·ä½¿ç”¨ä¸Šé¢mysqlå®¹å™¨ç›¸åŒçš„ç”¨æˆ·åå’Œå¯†ç  !!!
      - DANMUAPI_DATABASE__USER=danmuapi                      #æ•°æ®åº“ç”¨æˆ·å
      - DANMUAPI_DATABASE__PASSWORD=your_strong_user_password #æ•°æ®åº“å¯†ç 
      # --- ç¼“å­˜é…ç½®ï¼ˆå¯é€‰ï¼‰---
      # é»˜è®¤ä½¿ç”¨ hybrid æ¨¡å¼ï¼ˆå†…å­˜ L1 + æ•°æ®åº“ L2ï¼‰ï¼Œæ— éœ€é¢å¤–æœåŠ¡
      # å¯é€‰åç«¯: memoryï¼ˆçº¯å†…å­˜ï¼‰/ redis / databaseï¼ˆçº¯æ•°æ®åº“ï¼‰/ hybridï¼ˆé»˜è®¤ï¼‰
      # - DANMUAPI_CACHE__BACKEND=redis
      # - DANMUAPI_CACHE__REDIS_URL=redis://:your_password@redis:6379/0
      # - DANMUAPI_CACHE__REDIS_MAX_MEMORY=256mb
      # - DANMUAPI_CACHE__REDIS_SOCKET_TIMEOUT=30
      # - DANMUAPI_CACHE__REDIS_SOCKET_CONNECT_TIMEOUT=5
      # - DANMUAPI_CACHE__MEMORY_MAXSIZE=1024
      # - DANMUAPI_CACHE__MEMORY_DEFAULT_TTL=600
      # --- åˆå§‹ç®¡ç†å‘˜é…ç½® ---
      - DANMUAPI_ADMIN__INITIAL_USER=admin
    volumes:
      - ./config:/app/config
      # Docker å¥—æ¥å­—æ˜ å°„ - ç”¨äºä¸€é”®æ›´æ–°åŠŸèƒ½
      # æ˜ å°„å®¿ä¸»æœºçš„ Docker å¥—æ¥å­—åˆ°å®¹å™¨å†…ï¼Œä½¿å®¹å™¨å¯ä»¥ç®¡ç† Docker
      # æ³¨æ„ï¼šè¿™ä¼šèµ‹äºˆå®¹å™¨è¾ƒé«˜æƒé™ï¼Œè¯·ç¡®ä¿æ‚¨äº†è§£å®‰å…¨é£é™©
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - "7768:7768"
    networks:
      - misaka-net

networks:
  misaka-net:
    driver: bridge
```

::: tip Docker å¥—æ¥å­—è¯´æ˜
`/var/run/docker.sock` æ˜¯ Docker å®ˆæŠ¤è¿›ç¨‹çš„ Unix å¥—æ¥å­—æ–‡ä»¶ã€‚æ˜ å°„æ­¤æ–‡ä»¶åï¼Œå®¹å™¨å†…çš„åº”ç”¨å¯ä»¥ä¸å®¿ä¸»æœºçš„ Docker å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ï¼Œä»è€Œå®ç°ï¼š
- **ä¸€é”®æ›´æ–°**: è‡ªåŠ¨æ‹‰å–æœ€æ–°é•œåƒå¹¶é‡å¯å®¹å™¨
- **åŠ è½½å¼¹å¹•æºåå®¹å™¨é‡å¯**ï¼šç”¨äºå®¹å™¨é‡å¯ï¼Œé‡æ–°åŠ è½½å¼¹å¹•æº
- **å®¹å™¨ç®¡ç†**: æŸ¥çœ‹å’Œç®¡ç†å…¶ä»–å®¹å™¨çŠ¶æ€

âš ï¸ **å®‰å…¨æç¤º**: æ˜ å°„ Docker å¥—æ¥å­—ä¼šèµ‹äºˆå®¹å™¨è¾ƒé«˜æƒé™ï¼Œä»…åœ¨ä¿¡ä»»çš„ç¯å¢ƒä¸­ä½¿ç”¨ã€‚
>dockerå¥—æ¥å­—å¯æ ¹æ®ä¸ªäººéœ€è¦å†³å®šæ˜¯å¦æ˜ å°„
:::

### æ–¹æ¡ˆ A-2: ä½¿ç”¨ MySQL (å°å†…å­˜æ¨¡å¼)

> ğŸ’¡ **é€‚ç”¨åœºæ™¯**: é€‚åˆå†…å­˜æœ‰é™çš„ VPS (å¦‚ 512MB-1GB),é€šè¿‡ä¼˜åŒ– MySQL é…ç½®å‡å°‘å†…å­˜å ç”¨ã€‚

```yaml
version: "3.8"
services:
  mysql:
    image: mysql:8.1.0-oracle
    container_name: danmu-mysql
    restart: unless-stopped
    environment:
      # !!! é‡è¦ï¼šè¯·åŠ¡å¿…æ›¿æ¢ä¸ºæ‚¨çš„å¼ºå¯†ç  !!!
      MYSQL_ROOT_PASSWORD: "your_strong_root_password"                  #æ•°æ®åº“rootå¯†ç 
      MYSQL_DATABASE: "danmuapi"                                        #æ•°æ®åº“åç§°
      MYSQL_USER: "danmuapi"                                            #æ•°æ®åº“ç”¨æˆ·å
      MYSQL_PASSWORD: "your_strong_user_password"                       #æ•°æ®åº“å¯†ç 
      TZ: "Asia/Shanghai"
    volumes:
      - ./db-data:/var/lib/mysql
    command:
      - '--character-set-server=utf8mb4'
      - '--collation-server=utf8mb4_unicode_ci'
      - '--binlog_expire_logs_seconds=259200'
      - '--default-authentication-plugin=mysql_native_password'
      # --- å°å†…å­˜ä¼˜åŒ–é…ç½® ---
      - '--innodb_buffer_pool_size=128M'           # InnoDBç¼“å†²æ± å¤§å° (é»˜è®¤128M,å¯æ ¹æ®å†…å­˜è°ƒæ•´)
      - '--innodb_log_file_size=32M'               # æ—¥å¿—æ–‡ä»¶å¤§å°
      - '--innodb_log_buffer_size=8M'              # æ—¥å¿—ç¼“å†²åŒºå¤§å°
      - '--max_connections=50'                     # æœ€å¤§è¿æ¥æ•° (é»˜è®¤151,å‡å°‘åˆ°50)
      - '--table_open_cache=64'                    # è¡¨ç¼“å­˜ (é»˜è®¤4000,å‡å°‘åˆ°64)
      - '--performance_schema=OFF'                 # å…³é—­æ€§èƒ½ç›‘æ§ (èŠ‚çœå†…å­˜)
      - '--innodb_flush_log_at_trx_commit=2'       # æ—¥å¿—åˆ·æ–°ç­–ç•¥ (æå‡æ€§èƒ½,ç•¥é™å®‰å…¨æ€§)
      - '--innodb_flush_method=O_DIRECT'           # ç»•è¿‡æ“ä½œç³»ç»Ÿç¼“å­˜
    healthcheck:
      test: ["CMD-SHELL", "mysqladmin ping -u$${MYSQL_USER} -p$${MYSQL_PASSWORD}"]
      interval: 5s
      timeout: 3s
      retries: 5
      start_period: 30s
    networks:
      - misaka-net

  danmu-app:
    image: l429609201/misaka_danmu_server:latest
    container_name: misaka-danmu-server
    restart: unless-stopped
    depends_on:
      mysql:
        condition: service_healthy
    environment:
      - PUID=1000
      - PGID=1000
      - UMASK=0022
      - TZ=Asia/Shanghai
      # --- æ•°æ®åº“è¿æ¥é…ç½® ---
      - DANMUAPI_DATABASE__TYPE=mysql
      - DANMUAPI_DATABASE__HOST=mysql
      - DANMUAPI_DATABASE__PORT=3306
      - DANMUAPI_DATABASE__NAME=danmuapi
      # !!! é‡è¦ï¼šè¯·ä½¿ç”¨ä¸Šé¢mysqlå®¹å™¨ç›¸åŒçš„ç”¨æˆ·åå’Œå¯†ç  !!!
      - DANMUAPI_DATABASE__USER=danmuapi
      - DANMUAPI_DATABASE__PASSWORD=your_strong_user_password
      # --- ç¼“å­˜é…ç½®ï¼ˆå¯é€‰ï¼‰---
      # é»˜è®¤ä½¿ç”¨ hybrid æ¨¡å¼ï¼ˆå†…å­˜ L1 + æ•°æ®åº“ L2ï¼‰ï¼Œæ— éœ€é¢å¤–æœåŠ¡
      # å¯é€‰åç«¯: memoryï¼ˆçº¯å†…å­˜ï¼‰/ redis / databaseï¼ˆçº¯æ•°æ®åº“ï¼‰/ hybridï¼ˆé»˜è®¤ï¼‰
      # - DANMUAPI_CACHE__BACKEND=redis
      # - DANMUAPI_CACHE__REDIS_URL=redis://:your_password@redis:6379/0
      # - DANMUAPI_CACHE__REDIS_MAX_MEMORY=256mb
      # - DANMUAPI_CACHE__REDIS_SOCKET_TIMEOUT=30
      # - DANMUAPI_CACHE__REDIS_SOCKET_CONNECT_TIMEOUT=5
      # - DANMUAPI_CACHE__MEMORY_MAXSIZE=1024
      # - DANMUAPI_CACHE__MEMORY_DEFAULT_TTL=600
      # --- åˆå§‹ç®¡ç†å‘˜é…ç½® ---
      - DANMUAPI_ADMIN__INITIAL_USER=admin
    volumes:
      - ./config:/app/config
      # Docker å¥—æ¥å­—æ˜ å°„ - ç”¨äºä¸€é”®æ›´æ–°åŠŸèƒ½
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - "7768:7768"
    networks:
      - misaka-net

networks:
  misaka-net:
    driver: bridge
```

### æ–¹æ¡ˆ B: ä½¿ç”¨ PostgreSQL 18 (å¯é€‰)

```yaml
version: "3.8"
services:
  postgres:
    image: postgres:18
    container_name: danmu-postgres
    restart: unless-stopped
    user: "1000:1000"
    environment:
      # !!! é‡è¦ï¼šè¯·åŠ¡å¿…æ›¿æ¢ä¸ºæ‚¨çš„å¼ºå¯†ç  !!!
      POSTGRES_PASSWORD: "your_strong_postgres_password"               #æ•°æ®åº“å¯†ç 
      POSTGRES_USER: "danmuapi"                                        #æ•°æ®åº“ç”¨æˆ·å
      POSTGRES_DB: "danmuapi"                                          #æ•°æ®åº“åç§°
      TZ: "Asia/Shanghai"
    volumes:
      - ./db-data:/var/lib/postgresql                                  # PostgreSQL 18 æŒ‚è½½è·¯å¾„å˜æ›´
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U danmuapi -d danmuapi"]
      interval: 5s
      timeout: 3s
      retries: 5
      start_period: 30s
    networks:
      - misaka-net

  danmu-app:
    image: l429609201/misaka_danmu_server:latest
    container_name: misaka-danmu-server
    restart: unless-stopped
    depends_on:
      postgres:
        condition: service_healthy
    environment:
      # è®¾ç½®è¿è¡Œå®¹å™¨çš„ç”¨æˆ·å’Œç»„IDï¼Œä»¥åŒ¹é…æ‚¨å®¿ä¸»æœºçš„ç”¨æˆ·ï¼Œé¿å…æŒ‚è½½å·çš„æƒé™é—®é¢˜ã€‚
      - PUID=1000
      - PGID=1000
      - UMASK=0022
      - TZ=Asia/Shanghai
      # --- æ•°æ®åº“è¿æ¥é…ç½® ---
      - DANMUAPI_DATABASE__TYPE=postgresql                              # æ•°æ®åº“ç±»å‹
      - DANMUAPI_DATABASE__HOST=postgres                                # ä½¿ç”¨æœåŠ¡å
      - DANMUAPI_DATABASE__PORT=5432                                    # æ•°æ®åº“ç«¯å£
      - DANMUAPI_DATABASE__NAME=danmuapi                                # æ•°æ®åº“åç§°
      # !!! é‡è¦ï¼šè¯·ä½¿ç”¨ä¸Šé¢postgreså®¹å™¨ç›¸åŒçš„ç”¨æˆ·åå’Œå¯†ç  !!!
      - DANMUAPI_DATABASE__USER=danmuapi                                # æ•°æ®åº“ç”¨æˆ·å
      - DANMUAPI_DATABASE__PASSWORD=your_strong_postgres_password       # æ•°æ®åº“å¯†ç 
      # --- ç¼“å­˜é…ç½®ï¼ˆå¯é€‰ï¼‰---
      # é»˜è®¤ä½¿ç”¨ hybrid æ¨¡å¼ï¼ˆå†…å­˜ L1 + æ•°æ®åº“ L2ï¼‰ï¼Œæ— éœ€é¢å¤–æœåŠ¡
      # å¯é€‰åç«¯: memoryï¼ˆçº¯å†…å­˜ï¼‰/ redis / databaseï¼ˆçº¯æ•°æ®åº“ï¼‰/ hybridï¼ˆé»˜è®¤ï¼‰
      # - DANMUAPI_CACHE__BACKEND=redis
      # - DANMUAPI_CACHE__REDIS_URL=redis://:your_password@redis:6379/0
      # - DANMUAPI_CACHE__REDIS_MAX_MEMORY=256mb
      # - DANMUAPI_CACHE__REDIS_SOCKET_TIMEOUT=30
      # - DANMUAPI_CACHE__REDIS_SOCKET_CONNECT_TIMEOUT=5
      # - DANMUAPI_CACHE__MEMORY_MAXSIZE=1024
      # - DANMUAPI_CACHE__MEMORY_DEFAULT_TTL=600
      # --- åˆå§‹ç®¡ç†å‘˜é…ç½® ---
      - DANMUAPI_ADMIN__INITIAL_USER=admin
    volumes:
      - ./config:/app/config
      # Docker å¥—æ¥å­—æ˜ å°„ - ç”¨äºä¸€é”®æ›´æ–°åŠŸèƒ½
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - "7768:7768"
    networks:
      - misaka-net

networks:
  misaka-net:
    driver: bridge
```

## æ­¥éª¤ 1-1: æ‹†åˆ†éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

> ğŸ’¡ å¦‚æœæ‚¨å¸Œæœ›åˆ†åˆ«ç®¡ç†æ•°æ®åº“å’Œåº”ç”¨å®¹å™¨ï¼Œæˆ–è€…å·²æœ‰ç‹¬ç«‹è¿è¡Œçš„æ•°æ®åº“ï¼Œå¯ä»¥é€‰æ‹©æ‹†åˆ†éƒ¨ç½²ã€‚

### 1-1-Aï¼šMySQL æ•°æ®åº“ compose æ–‡ä»¶

åˆ›å»º `docker-compose-db.yaml`ï¼š

```yaml
version: "3.8"
services:
  mysql:
    image: mysql:8.1.0-oracle
    container_name: danmu-mysql
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: "your_strong_root_password"
      MYSQL_DATABASE: "danmuapi"
      MYSQL_USER: "danmuapi"
      MYSQL_PASSWORD: "your_strong_user_password"
      TZ: "Asia/Shanghai"
    volumes:
      - ./db-data:/var/lib/mysql
    command:
      - '--character-set-server=utf8mb4'
      - '--collation-server=utf8mb4_unicode_ci'
      - '--binlog_expire_logs_seconds=259200'
      - '--default-authentication-plugin=mysql_native_password'
    ports:
      - "3306:3306"  # å¦‚éœ€å¤–éƒ¨è®¿é—®
    networks:
      - misaka-net

networks:
  misaka-net:
    driver: bridge
```

---

### 1-1-Bï¼šPostgreSQL 18 æ•°æ®åº“ compose æ–‡ä»¶

åˆ›å»º `docker-compose-db.yaml`ï¼š

```yaml
version: "3.8"
services:
  postgres:
    image: postgres:18
    container_name: danmu-postgres
    restart: unless-stopped
    user: "1000:1000"
    environment:
      POSTGRES_PASSWORD: "your_strong_postgres_password"
      POSTGRES_USER: "danmuapi"
      POSTGRES_DB: "danmuapi"
      TZ: "Asia/Shanghai"
    volumes:
      - ./db-data:/var/lib/postgresql                # PostgreSQL 18 æŒ‚è½½è·¯å¾„å˜æ›´
    ports:
      - "5432:5432"  # å¦‚éœ€å¤–éƒ¨è®¿é—®
    networks:
      - misaka-net

networks:
  misaka-net:
    driver: bridge
```

---

### 1-1-Cï¼šè¿æ¥å·²æœ‰æ•°æ®åº“

å¦‚æœæ‚¨å·²æœ‰ç‹¬ç«‹è¿è¡Œçš„æ•°æ®åº“ï¼Œå¯è·³è¿‡ä¸Šé¢çš„æ•°æ®åº“ composeï¼Œç›´æ¥ä½¿ç”¨ä¸‹æ–¹çš„å¼¹å¹•åº“ compose å¹¶ä¿®æ”¹æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚

> ï¿½ è¯¦ç»†çš„æ•°æ®åº“é…ç½®æ“ä½œè¯·å‚è€ƒï¼š[è¿æ¥å·²æœ‰æ•°æ®åº“](/ops/è¿æ¥å·²æœ‰æ•°æ®åº“)

---

### å¼¹å¹•åº“åº”ç”¨ compose æ–‡ä»¶

åˆ›å»º `docker-compose-app.yaml`ï¼š

```yaml
version: "3.8"
services:
  danmu-app:
    image: l429609201/misaka_danmu_server:latest
    container_name: misaka-danmu-server
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - UMASK=0022
      - TZ=Asia/Shanghai
      # ============ æ•°æ®åº“è¿æ¥é…ç½® ============
      # --- å¦‚æœä½¿ç”¨ MySQL (1-1-A)ï¼Œä½¿ç”¨ä»¥ä¸‹é…ç½® ---
      - DANMUAPI_DATABASE__TYPE=mysql
      - DANMUAPI_DATABASE__HOST=danmu-mysql          # MySQL å®¹å™¨å
      - DANMUAPI_DATABASE__PORT=3306
      # --- å¦‚æœä½¿ç”¨ PostgreSQL 18 (1-1-B)ï¼Œæ”¹ç”¨ä»¥ä¸‹é…ç½® ---
      # - DANMUAPI_DATABASE__TYPE=postgresql
      # - DANMUAPI_DATABASE__HOST=danmu-postgres     # PostgreSQL å®¹å™¨å
      # - DANMUAPI_DATABASE__PORT=5432
      # --- å¦‚æœä½¿ç”¨å·²æœ‰æ•°æ®åº“ (1-1-C)ï¼Œå¡«å†™å®é™…çš„æ•°æ®åº“åœ°å€ ---
      # - DANMUAPI_DATABASE__HOST=192.168.1.100      # æ•°æ®åº“æœåŠ¡å™¨IP
      # ==========================================
      - DANMUAPI_DATABASE__NAME=danmuapi
      - DANMUAPI_DATABASE__USER=danmuapi
      - DANMUAPI_DATABASE__PASSWORD=your_strong_user_password  # ä¸æ•°æ®åº“å¯†ç ä¸€è‡´
      - DANMUAPI_ADMIN__INITIAL_USER=admin
    volumes:
      - ./config:/app/config
      # Docker å¥—æ¥å­—æ˜ å°„ - ç”¨äºä¸€é”®æ›´æ–°åŠŸèƒ½
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - "7768:7768"
    networks:
      - misaka-net

networks:
  misaka-net:
    external: true
    name: danmuku_misaka-net   # éœ€ä¸æ•°æ®åº“çš„ç½‘ç»œåä¸€è‡´
```

### 1-1-Cï¼šRedis ç¼“å­˜æœåŠ¡ compose æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

å¦‚æœæ‚¨éœ€è¦ä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜åç«¯ï¼Œå¯ä»¥åˆ›å»º `docker-compose-redis.yaml`ï¼š

```yaml
version: '3.8'
services:
  redis:
    image: redis:8.4.0
    container_name: redis-server
    restart: unless-stopped
    # Redis å¯åŠ¨å‘½ä»¤é…ç½®
    # --save 600 1: æ¯600ç§’ï¼ˆ10åˆ†é’Ÿï¼‰å¦‚æœè‡³å°‘æœ‰1ä¸ªkeyè¢«ä¿®æ”¹åˆ™ä¿å­˜æ•°æ®åˆ°ç£ç›˜
    # --requirepass: è®¾ç½® Redis è®¿é—®å¯†ç 
    command: redis-server --save 600 1 --requirepass "your_redis_password"
    ports:
      - '6379:6379'
    volumes:
      - ./redis-data:/data  # Redis æ•°æ®æŒä¹…åŒ–ç›®å½•
    networks:
      - misaka-net

networks:
  misaka-net:
    external: true
    name: danmuku_misaka-net   # éœ€ä¸æ•°æ®åº“çš„ç½‘ç»œåä¸€è‡´
```

::: tip Redis é…ç½®è¯´æ˜
- **å¯†ç è®¾ç½®**: è¯·å°† `your_redis_password` æ›¿æ¢ä¸ºæ‚¨çš„å¼ºå¯†ç 
- **æ•°æ®æŒä¹…åŒ–**: Redis æ•°æ®å°†ä¿å­˜åœ¨ `./redis-data` ç›®å½•
- **ç½‘ç»œé…ç½®**: éœ€è¦ä¸æ•°æ®åº“å’Œåº”ç”¨ä½¿ç”¨ç›¸åŒçš„ Docker ç½‘ç»œ
- **åº”ç”¨é…ç½®**: å¯åŠ¨ Redis åï¼Œéœ€è¦åœ¨åº”ç”¨çš„ compose æ–‡ä»¶ä¸­å–æ¶ˆæ³¨é‡Š Redis ç›¸å…³çš„ç¯å¢ƒå˜é‡é…ç½®
:::

### å¯åŠ¨æ­¥éª¤

```bash
# 1. å…ˆå¯åŠ¨æ•°æ®åº“ï¼ˆé€‰æ‹© 1-1-A æˆ– 1-1-B å…¶ä¸­ä¸€ä¸ªï¼‰
docker-compose -f docker-compose-db.yaml up -d

# 2. (å¯é€‰) å¦‚æœéœ€è¦ Redis ç¼“å­˜ï¼Œå¯åŠ¨ Redis æœåŠ¡
docker-compose -f docker-compose-redis.yaml up -d

# 3. ç­‰å¾…æ•°æ®åº“å¯åŠ¨å®Œæˆåï¼ˆçº¦30ç§’ï¼‰ï¼Œå†å¯åŠ¨åº”ç”¨
docker-compose -f docker-compose-app.yaml up -d
```

---

## æ­¥éª¤ 2: ä¿®æ”¹é…ç½®å¹¶å¯åŠ¨

1. **é‡è¦**: æ‰“å¼€ `docker-compose.yaml` æ–‡ä»¶ï¼Œå°†æ‰€æœ‰å¯†ç æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„å®‰å…¨å¯†ç ã€‚

2. **(å¯é€‰) ä½¿ç”¨ GitHub é•œåƒæº**: å¦‚æœæ‹‰å– Docker Hub é•œåƒæ—¶é‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œå¯å°†é•œåƒåœ°å€æ›¿æ¢ä¸ºï¼š
   ```yaml
   image: ghcr.io/l429609201/misaka_danmu_server:latest
   ```

3. å¯åŠ¨åº”ç”¨ï¼š
```bash
docker-compose up -d
```

## æ­¥éª¤ 3: è®¿é—®å’Œé…ç½®

- **è®¿é—®Web UI**: æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® `http://<æ‚¨çš„æœåŠ¡å™¨IP>:7768`
- **åˆå§‹ç™»å½•**:
  - ç”¨æˆ·å: `admin`
  - å¯†ç : é¦–æ¬¡å¯åŠ¨æ—¶ä¼šåœ¨å®¹å™¨æ—¥å¿—ä¸­ç”Ÿæˆï¼Œä½¿ç”¨ `docker logs misaka-danmu-server` æŸ¥çœ‹
- **å¼€å§‹ä½¿ç”¨**: ç™»å½•åè¯·å…ˆä¿®æ”¹å¯†ç ï¼Œç„¶åé…ç½®ï¼š
  - **å…ƒæ•°æ®æº**: [å…ƒæ•°æ®æºé…ç½®](/config/å…ƒæ•°æ®æºé…ç½®)
  - **AI åŠŸèƒ½** (å¯é€‰): [AI åŠŸèƒ½é…ç½®](/config/AIåŠŸèƒ½é…ç½®)
  - **å¼¹å¹•æº**: åœ¨ "å¼¹å¹•æº" é¡µé¢åŠ è½½æˆ–ä¸Šä¼ å¼¹å¹•æºç¦»çº¿åŒ…

## æ­¥éª¤ 4: ç¯å¢ƒå˜é‡è¯´æ˜

### æ•°æ®åº“é…ç½®

| ç¯å¢ƒå˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|---------|------|--------|
| `DANMUAPI_DATABASE__TYPE` | æ•°æ®åº“ç±»å‹ (`mysql` æˆ– `postgresql`) | - |
| `DANMUAPI_DATABASE__HOST` | æ•°æ®åº“ä¸»æœºåœ°å€ | - |
| `DANMUAPI_DATABASE__PORT` | æ•°æ®åº“ç«¯å£ | `3306` / `5432` |
| `DANMUAPI_DATABASE__NAME` | æ•°æ®åº“åç§° | - |
| `DANMUAPI_DATABASE__USER` | æ•°æ®åº“ç”¨æˆ·å | - |
| `DANMUAPI_DATABASE__PASSWORD` | æ•°æ®åº“å¯†ç  | - |

### å…¶ä»–é…ç½®

| ç¯å¢ƒå˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|---------|------|--------|
| `DANMUAPI_ADMIN__INITIAL_USER` | åˆå§‹ç®¡ç†å‘˜ç”¨æˆ·å | `admin` |
| `PUID` | è¿è¡Œå®¹å™¨çš„ç”¨æˆ· ID | `1000` |
| `PGID` | è¿è¡Œå®¹å™¨çš„ç»„ ID | `1000` |
| `TZ` | æ—¶åŒº | `Asia/Shanghai` |

---

## ğŸ“š ä¸‹ä¸€æ­¥

- **[ğŸ“± å®¢æˆ·ç«¯é…ç½®](/å®¢æˆ·ç«¯é…ç½®)** - é…ç½®æ’­æ”¾å™¨å¼¹å¹•æ¥å£
- **[ğŸ¬ å…ƒæ•°æ®æºé…ç½®](/config/å…ƒæ•°æ®æºé…ç½®)** - é…ç½® TMDB, TVDB ç­‰ API å¯†é’¥
- **[ğŸ¤– AI åŠŸèƒ½é…ç½®](/config/AIåŠŸèƒ½é…ç½®)** - é…ç½® AI æ™ºèƒ½åŒ¹é…åŠŸèƒ½
- **[ğŸ”— Webhook é…ç½®](/config/Webhooké…ç½®)** - é…ç½® Emby/Jellyfin/Plex è‡ªåŠ¨åŒ–
