# ⏰ 定时任务

本服务提供多个定时任务，用于自动化维护弹幕库和优化匹配效果。

![定时任务](/screenshot/定时任务.png)

## 任务列表概览

| 任务名称 | 功能 | 默认周期 |
|---------|------|---------|
| TMDB自动刮削与剧集组映射 | 自动刮削别名和剧集组信息 | 每日 |
| 弹幕自动刷新 | 自动刷新弹幕数据 | 每周 |
| 缓存清理 | 清理过期缓存数据 | 每日 |
| 日志清理 | 清理过期日志文件 | 每周 |

---

## TMDB自动刮削与剧集组映射

### 功能说明

此任务会自动从 TMDB 获取作品的元数据信息，包括：

- **别名刮削**: 获取作品的各语言别名，添加到条目中
- **剧集组映射**: 自动识别和映射 TMDB 的剧集组（Episode Groups）

### 为什么需要别名？

播放器请求弹幕时通常使用文件名进行匹配。不同的命名方式可能导致匹配失败：

- 中文名：`权力的游戏`
- 英文名：`Game of Thrones`
- 简称：`权游`

通过自动刮削别名，可以大幅提高匹配成功率。

### 配置方法

1. 进入 **"设置"** → **"定时任务"**
2. 找到 **"TMDB自动刮削与剧集组映射"** 任务
3. 配置选项：
   - **启用状态**: 开启/关闭任务
   - **执行周期**: 设置执行频率（如每日凌晨3点）
   - **刮削范围**: 全部条目 / 仅缺失别名的条目

### 手动执行

在任务列表中点击 **"立即执行"** 可以手动触发此任务。

---

## 刷新最新集弹幕/定时增量追更

### 功能说明

定期从弹幕源重新获取弹幕数据，确保弹幕库保持最新。

### 刷新策略

- **刷新最新集弹幕**: 只刷新被标记定时的源的最新集
- **定时增量追更**: 尝试获取被标记定时的源的下一集

### 配置方法

1. 进入 **"设置"** → **"定时任务"**
2. 找到 **"刷新最新集弹幕/定时增量追更"** 任务
3. 配置选项：
   - **启用状态**: 开启/关闭任务
   - **执行周期**: 设置执行频率
   - **刷新策略**: 最新集全量刷新 / 增量刷新 
   - **刷新范围**: 被标记定时的源的最新集弹幕 / 被标记定时的源的下一集

---

## 缓存日志清理任务

### 功能说明

清理系统产生的各类缓存数据，释放存储空间。

### 清理范围

- API 响应缓存
- 搜索结果缓存
- 临时文件

### 配置方法

1. 进入 **"设置"** → **"定时任务"**
2. 找到 **"缓存日志清理任务"** 任务
3. 配置选项：
   - **启用状态**: 开启/关闭任务
   - **执行周期**: 设置执行频率
   - **缓存保留天数**: 保留最近N天的缓存

详细说明请参考 **[🧹 缓存日志清理任务说明](/ops/缓存日志清理任务说明)**


---

## 查看任务执行状态

### 任务历史

在 **"任务"** 页面可以查看：

- 任务执行历史记录
- 每次执行的开始时间、结束时间、耗时
- 执行结果（成功/失败）
- 详细日志

### 执行中的任务

正在执行的任务会显示进度条和当前状态。

---

## 📚 相关文档

- **[📚 弹幕库管理](/advanced/弹幕库管理)** - 条目和分集管理
- **[🧹 缓存日志清理](/ops/缓存日志清理任务说明)** - 缓存和日志清理详解
- **[🎬 元数据源配置](/config/元数据源配置)** - TMDB API 配置

