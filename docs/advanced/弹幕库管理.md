# 📚 弹幕库管理

弹幕库是本服务的核心功能，从弹幕源中下载的弹幕媒体会以条目的形式在这里集中管理。

![弹幕库](/screenshot/弹幕库.png)

## 条目结构

每个条目代表一个影视作品（电影或剧集），其结构如下：

- **条目（作品）**
  - 基础信息：标题、年份、类型、海报等
  - 别名列表：用于提高匹配成功率
  - **弹幕来源 1**
    - 分集 1
    - 分集 2
    - ...
  - **弹幕来源 2**
    - 分集 1
    - 分集 2
    - ...

## 条目管理

### 查看条目列表

在 Web UI 的 **"弹幕库"** 页面，可以查看所有已导入的条目：

- 支持按标题搜索
- 支持按类型（电影/剧集）筛选
- 显示条目的海报、标题、来源数量、分集数量等信息

### 编辑条目信息

点击条目进入详情页，可以编辑以下信息：

- **标题**: 作品的主标题
- **别名**: 添加多个别名，提高播放器匹配成功率
- **年份**: 上映/播出年份
- **类型**: 电影或剧集
- **TMDB ID / TVDB ID**: 关联的元数据ID

![条目元信息编辑](/screenshot/媒体库条目元信息编辑.png)

### 删除条目

在条目详情页或列表页，可以删除不再需要的条目。删除条目会同时删除其下所有弹幕来源和分集。

---

## 弹幕来源管理

每个条目可以有多个弹幕来源（如 B站、爱奇艺、优酷等）。

### 查看弹幕来源

在条目详情页，可以查看该条目的所有弹幕来源：

- 来源名称和图标
- 该来源下的分集数量
- 来源的状态

### 切换默认来源

当一个条目有多个弹幕来源时，可以设置默认使用的来源。播放器请求弹幕时会优先返回默认来源的弹幕。

---

## 分集管理

每个弹幕来源下可以有多个分集。

![分集管理](/screenshot/分集管理.png)

### 查看分集列表

点击弹幕来源，可以查看该来源下的所有分集：

- 分集编号
- 分集标题
- 弹幕数量
- 最后更新时间

### 刷新分集弹幕

可以手动刷新某个分集的弹幕，从源站重新获取最新弹幕。

### 删除分集

可以删除不需要的分集及其弹幕数据。

---

## 自定义创建条目

除了从弹幕源搜索导入外，还支持手动创建条目：

![自定义条目创建](/screenshot/媒体库-自定义条目创建.png)

### 创建步骤

1. 在 **"弹幕库"** 页面点击 **"新建条目"** 按钮
2. 填写条目信息：
   - 标题（必填）
   - 类型（电影/剧集）
   - 年份
   - 别名
3. 点击 **"创建"** 完成

### 适用场景

- 导入本地已有的 XML 弹幕文件
- 创建不在弹幕源中的作品
- 自定义组织弹幕库结构

---

## 导入 XML 弹幕

支持导入 dandanplay 格式的 XML 弹幕文件。

### 单文件导入

1. 进入条目详情页
2. 点击 **"导入 XML"** 按钮
3. 选择本地的 `.xml` 弹幕文件
4. 系统自动解析并导入

![导入XML弹幕文件](/screenshot/媒体库-自定义条目-导入xml弹幕文件.png)

### 批量导入

支持批量导入多个 XML 文件：

1. 在条目详情页点击 **"批量导入"**
2. 选择多个 `.xml` 文件
3. 系统会根据文件名自动匹配分集
4. 确认匹配结果后导入

![批量导入XML弹幕文件](/screenshot/媒体库-自定义条目-批量导入xml弹幕文件.png)

### XML 文件格式

标准的 dandanplay XML 弹幕格式：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<i>
  <d p="时间,类型,大小,颜色,时间戳,弹幕池,发送者,弹幕ID">弹幕内容</d>
  ...
</i>
```

---

## 自动刮削别名

通过定时任务 **"TMDB自动刮削与剧集组映射"** 可以自动为条目添加别名，提高匹配成功率。

详细配置请参考 **[⏰ 定时任务](/ops/定时任务)** 文档。

---

## 📚 相关文档

- **[🔧 弹幕源管理](/advanced/弹幕源管理)** - 弹幕源加载与管理
- **[⏰ 定时任务](/ops/定时任务)** - 定时任务配置
- **[📱 客户端配置](/客户端配置)** - 播放器配置

